<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D照片表白墙</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            touch-action: none;
            font-family: 'Arial', sans-serif;
        }

        body {
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
        }

        /* 加载界面 */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #111;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #21D4FD;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 18px;
            color: #fff;
        }

        /* 开始按钮 */
        .start-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            text-align: center;
        }

        .title {
            font-size: 2.5rem;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #21D4FD, #B721FF);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .click_me {
            width: 200px;
            height: 200px;
            font-size: 24px;
            color: #fff;
            background: none;
            border: none;
            border-radius: 20px;
            position: relative;
            z-index: 0;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        @property --d {
            syntax: '<angle>';
            inherits: true;
            initial-value: 0deg;
        }

        .click_me:before {
            content: "";
            position: absolute;
            inset: -8px;
            padding: 8px;
            border-radius: 28px;
            background: conic-gradient(from var(--d, 0deg),
                    #21D4FD,
                    #0000 30deg 120deg,
                    #B721FF 150deg 180deg,
                    #0000 210deg 300deg,
                    #21D4FD 330deg);
            -webkit-mask:
                linear-gradient(#000 0 0) content-box,
                linear-gradient(#000 0 0);
            -webkit-mask-composite: xor;
            mask-composite: intersect;
        }

        .click_me:after {
            content: "";
            position: absolute;
            inset: -100px;
            background:
                radial-gradient(80px at left 150px top 120px, #21D4FD 98%, #0000),
                radial-gradient(80px at right 150px bottom 120px, #B721FF 98%, #0000);
            filter: blur(60px);
            opacity: 0.5;
        }

        .click_me:before,
        .click_me:after {
            transition: 0.5s, 99999s 99999s transform, 99999s 99999s --d;
        }

        .click_me:hover {
            box-shadow: 0 0 20px rgba(33, 212, 253, 0.5);
            transform: scale(1.05);
        }

        .click_me:hover:after {
            transform: rotate(3600deg);
            transition: 0.5s, 60s linear transform;
        }

        .click_me:hover:before {
            --d: 3600deg;
            transition: 0.5s, 60s linear --d;
        }

        /* 照片墙容器 */
        .photo-wall {
            position: relative;
            width: 100%;
            height: 100%;
            display: none;
        }

        #dragBox {
            position: relative;
            display: flex;
            margin: auto;
            transform-style: preserve-3d;
            transform: rotateX(-30deg);
            width: 100%;
            height: 100%;
            justify-content: center;
            align-items: center;
        }

        .spinBox {
            position: relative;
            width: 120px;
            height: 140px;
            transform-style: preserve-3d;
            animation: spin 200s infinite linear;
        }

        #spinBox2 {
            position: absolute;
            top: 10%;
        }

        #spinBox3 {
            position: absolute;
            top: -30%;
        }

        .spinBox img {
            transform-style: preserve-3d;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
            cursor: pointer;
            -webkit-box-reflect: below 10px linear-gradient(transparent, transparent, rgba(0, 0, 0, 0.3));
        }

        .spinBox img:hover {
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
            transform: scale(1.05);
        }

        /* 控制面板 */
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .control-btn i {
            font-size: 18px;
        }

        /* 照片详情模态框 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            max-width: 80%;
            max-height: 80%;
            position: relative;
            background: #222;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .modal-content img {
            width: 100%;
            height: auto;
            display: block;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 20px;
            z-index: 10;
        }

        /* 动画 */
        @keyframes spin {
            from {
                transform: rotateY(0deg);
            }
            to {
                transform: rotateY(360deg);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .title {
                font-size: 1.8rem;
            }
            
            .click_me {
                width: 150px;
                height: 150px;
                font-size: 18px;
            }
            
            .controls {
                bottom: 10px;
                padding: 8px 15px;
            }
            
            .control-btn {
                width: 35px;
                height: 35px;
            }
        }
    </style>
</head>
<body>
    <!-- 加载界面 -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">加载中...</div>
    </div>

    <!-- 开始界面 -->
    <div class="start-container" id="startContainer">
        <h1 class="title">我们的回忆</h1>
        <button class="click_me" id="startButton">开启回忆之旅</button>
    </div>

    <!-- 照片墙 -->
    <div class="photo-wall" id="photoWall">
        <div id="dragBox">
            <div class="spinBox" id="spinBox">
                <!-- 照片将通过JavaScript动态添加 -->
            </div>
            <div class="spinBox" id="spinBox2">
                <!-- 照片将通过JavaScript动态添加 -->
            </div>
            <div class="spinBox" id="spinBox3">
                <!-- 照片将通过JavaScript动态添加 -->
            </div>
        </div>
    </div>

    <!-- 控制面板 -->
    <div class="controls" id="controls">
        <button class="control-btn" id="zoomInBtn" title="放大">
            <i>+</i>
        </button>
        <button class="control-btn" id="zoomOutBtn" title="缩小">
            <i>-</i>
        </button>
        <button class="control-btn" id="playPauseBtn" title="暂停/播放旋转">
            <i>❚❚</i>
        </button>
        <button class="control-btn" id="musicBtn" title="音乐开关">
            <i>♪</i>
        </button>
    </div>

    <!-- 照片详情模态框 -->
    <div class="modal" id="imageModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">&times;</button>
            <img id="modalImage" src="" alt="照片详情">
        </div>
    </div>

    <!-- 音频 -->
    <audio loop id="backgroundMusic" preload="auto">
        <source src="img/落在生命里的光-尹昔眠.m4a" type="audio/mp4">
        您的浏览器不支持音频元素。
    </audio>

    <script>
        // 照片数据
        const photoData = [
            { src: 'img/1.webp', title: '美好瞬间1' },
            { src: 'img/2.webp', title: '美好瞬间2' },
            { src: 'img/3.webp', title: '美好瞬间3' },
            { src: 'img/4.webp', title: '美好瞬间4' },
            { src: 'img/5.webp', title: '美好瞬间5' },
            { src: 'img/6.webp', title: '美好瞬间6' },
            { src: 'img/7.webp', title: '美好瞬间7' },
            { src: 'img/8.webp', title: '美好瞬间8' },
            { src: 'img/9.webp', title: '美好瞬间9' },
            { src: 'img/10.webp', title: '美好瞬间10' },
            { src: 'img/11.webp', title: '美好瞬间11' },
            { src: 'img/12.webp', title: '美好瞬间12' },
            { src: 'img/13.webp', title: '美好瞬间13' },
            { src: 'img/14.webp', title: '美好瞬间14' },
            { src: 'img/15.webp', title: '美好瞬间15' },
            { src: 'img/16.webp', title: '美好瞬间16' },
            { src: 'img/17.webp', title: '美好瞬间17' },
            { src: 'img/18.webp', title: '美好瞬间18' },
            { src: 'img/19.webp', title: '美好瞬间19' },
            { src: 'img/20.webp', title: '美好瞬间20' }
        ];

        // DOM元素
        const loadingScreen = document.getElementById('loadingScreen');
        const startContainer = document.getElementById('startContainer');
        const startButton = document.getElementById('startButton');
        const photoWall = document.getElementById('photoWall');
        const dragBox = document.getElementById('dragBox');
        const spinBox = document.getElementById('spinBox');
        const spinBox2 = document.getElementById('spinBox2');
        const spinBox3 = document.getElementById('spinBox3');
        const controls = document.getElementById('controls');
        const zoomInBtn = document.getElementById('zoomInBtn');
        const zoomOutBtn = document.getElementById('zoomOutBtn');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const musicBtn = document.getElementById('musicBtn');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const imageModal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        const modalClose = document.getElementById('modalClose');

        // 全局变量
        let radius = 560;
        let isPlaying = true;
        let isMusicPlaying = false;
        let startX, startY, endX, endY, tX = 0, tY = 10, desX = 0, desY = 0;

        // 初始化函数
        function init() {
            // 模拟加载过程
            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    startContainer.style.display = 'block';
                }, 1000);
            }, 1500);

            // 动态添加照片
            addPhotosToSpinBox(spinBox, photoData);
            addPhotosToSpinBox(spinBox2, [...photoData.slice(1), photoData[0]]);
            addPhotosToSpinBox(spinBox3, [...photoData.slice(2), ...photoData.slice(0, 2)]);

            // 事件监听
            setupEventListeners();
        }

        // 添加照片到旋转盒子
        function addPhotosToSpinBox(spinBox, photos) {
            photos.forEach((photo, index) => {
                const img = document.createElement('img');
                img.src = photo.src;
                img.alt = photo.title;
                img.dataset.index = index;
                spinBox.appendChild(img);
            });
        }

        // 设置照片位置
        function setPhotoPositions(delayTime) {
            const spinBoxes = [spinBox, spinBox2, spinBox3];
            
            spinBoxes.forEach(box => {
                const photos = box.getElementsByTagName('img');
                const len = photos.length;
                
                for (let i = 0; i < len; i++) {
                    const photo = photos[i];
                    photo.style.transform = `rotateY(${i * (360 / len)}deg) translateZ(${radius}px)`;
                    photo.style.transition = 'transform 1s';
                    photo.style.transitionDelay = delayTime || `${(len - i) / 4}s`;
                }
            });
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 开始按钮点击事件
            startButton.addEventListener('click', startExperience);
            
            // 控制按钮事件
            zoomInBtn.addEventListener('click', () => {
                radius += 50;
                setPhotoPositions(0);
            });
            
            zoomOutBtn.addEventListener('click', () => {
                radius = Math.max(300, radius - 50);
                setPhotoPositions(0);
            });
            
            playPauseBtn.addEventListener('click', toggleRotation);
            
            musicBtn.addEventListener('click', toggleMusic);
            
            // 照片点击事件
            document.addEventListener('click', (e) => {
                if (e.target.tagName === 'IMG' && e.target.parentElement.classList.contains('spinBox')) {
                    openModal(e.target.src);
                }
            });
            
            // 模态框关闭事件
            modalClose.addEventListener('click', closeModal);
            imageModal.addEventListener('click', (e) => {
                if (e.target === imageModal) {
                    closeModal();
                }
            });
            
            // 鼠标/触摸事件
            setupDragEvents();
            
            // 鼠标滚轮事件
            document.addEventListener('wheel', handleWheel);
        }

        // 开始体验
        function startExperience() {
            startContainer.style.display = 'none';
            photoWall.style.display = 'block';
            
            // 播放音乐
            backgroundMusic.play().then(() => {
                isMusicPlaying = true;
                musicBtn.innerHTML = '<i>♪</i>';
            }).catch(error => {
                console.log('自动播放被阻止:', error);
            });
            
            // 初始化照片位置
            setTimeout(() => {
                setPhotoPositions();
            }, 500);
            
            // 添加点击特效
            addClickEffect();
        }

        // 添加点击特效
        function addClickEffect() {
            !function(e, t, a) {
                function r() {
                    for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
                    requestAnimationFrame(r)
                }
                function n() {
                    var t = "function" == typeof e.onclick && e.onclick;
                    e.onclick = function(e) {
                        t && t(), o(e)
                    }
                }
                function o(e) {
                    var a = t.createElement("div");
                    a.className = "heart", s.push({
                        el: a,
                        x: e.clientX - 5,
                        y: e.clientY - 5,
                        scale: 1,
                        alpha: 1,
                        color: c()
                    }), t.body.appendChild(a)
                }
                function i(e) {
                    var a = t.createElement("style");
                    a.type = "text/css";
                    try {
                        a.appendChild(t.createTextNode(e))
                    } catch (t) {
                        a.styleSheet.cssText = e
                    }
                    t.getElementsByTagName("head")[0].appendChild(a)
                }
                function c() {
                    return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
                }
                var s = [];
                e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function(e) {
                    setTimeout(e, 1e3 / 60)
                }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
            }(window, document);
        }

        // 切换旋转状态
        function toggleRotation() {
            isPlaying = !isPlaying;
            const spinBoxes = [spinBox, spinBox2, spinBox3];
            
            spinBoxes.forEach(box => {
                box.style.animationPlayState = isPlaying ? 'running' : 'paused';
            });
            
            playPauseBtn.innerHTML = isPlaying ? '<i>❚❚</i>' : '<i>▶</i>';
        }

        // 切换音乐状态
        function toggleMusic() {
            if (isMusicPlaying) {
                backgroundMusic.pause();
                musicBtn.innerHTML = '<i>🔇</i>';
            } else {
                backgroundMusic.play();
                musicBtn.innerHTML = '<i>♪</i>';
            }
            isMusicPlaying = !isMusicPlaying;
        }

        // 打开模态框
        function openModal(imageSrc) {
            modalImage.src = imageSrc;
            imageModal.classList.add('active');
        }

        // 关闭模态框
        function closeModal() {
            imageModal.classList.remove('active');
        }

        // 设置拖拽事件
        function setupDragEvents() {
            let isDragging = false;
            
            document.addEventListener('pointerdown', (e) => {
                isDragging = true;
                clearInterval(dragBox.timer);
                startX = e.clientX;
                startY = e.clientY;
                
                document.addEventListener('pointermove', handlePointerMove);
                document.addEventListener('pointerup', handlePointerUp);
            });
            
            function handlePointerMove(e) {
                if (!isDragging) return;
                
                toggleRotation();
                
                endX = e.clientX;
                endY = e.clientY;
                
                desX = endX - startX;
                desY = endY - startY;
                
                tX += desX * 0.1;
                tY += desY * 0.1;
                
                // 限制Y轴旋转角度
                tY = Math.max(0, Math.min(180, tY));
                
                changeRotate(dragBox);
                
                startX = endX;
                startY = endY;
            }
            
            function handlePointerUp() {
                isDragging = false;
                
                // 惯性效果
                dragBox.timer = setInterval(() => {
                    desX *= 0.95;
                    desY *= 0.95;
                    tX += desX * 0.1;
                    tY += desY * 0.1;
                    
                    changeRotate(dragBox);
                    
                    if (Math.abs(desX) < 0.5 && Math.abs(desY) < 0.5) {
                        clearInterval(dragBox.timer);
                        toggleRotation();
                    }
                }, 16);
                
                document.removeEventListener('pointermove', handlePointerMove);
                document.removeEventListener('pointerup', handlePointerUp);
            }
        }

        // 处理鼠标滚轮
        function handleWheel(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? -20 : 20;
            radius = Math.max(300, Math.min(800, radius + delta));
            setPhotoPositions(0);
        }

        // 改变旋转角度
        function changeRotate(obj) {
            obj.style.transform = `rotateX(${-tY}deg) rotateY(${tX}deg)`;
        }

        // 初始化应用
        init();
    </script>
</body>
</html>